#======================#
# Authors : Stefano Mona , Elise Gay, Romuald Laso-Jadart (MNHN - EPHE)
# Date : 2023
#	Please inform the authors before sharing
#======================#

# Aim : 
#------#
# Run example of genomic scans in sliding windows on two first scaffold 

# SCANS GENOMIC : 

   - ACP Global on all chromosome 
   - ACP on sliding windows
   - ACP on SNP range
   - FST on sliding windows
   - Global FST on sliding windows
   - FST by SNP by chromosome
   - PCadapt 
   - Fixed genotype by group in SW
   - Diversity (theta and TD) 
   - GLOBAL SFS by Chromosome
   - SFS in Sliding Windows: Euclidian distance of SFS in sliding windows vs global SFS on chromosome
   - LD : to do

# Input :
#----------#
# Table which summarise the samples (same order as all the VCF header)
  
  samples	  pop	
  sample_1	pop1
  sample_2	pop1
  sample_3	pop1
  sample_4	pop2
  sample_5	pop2
  
# If needed : a Bed file with genes coordinates 

# prefix of vcf to read depending on filters choose for scans
# Adapt to your vcf name
  VCF_0="_TAG_Flowqual_Noindels_Norepeat_SNP_21IND_DP10_50_10_200_Na0_60.vcf.gz"
  VCF_20="_TAG_Flowqual_Noindels_Norepeat_SNP_21IND_DP10_50_10_200_Na20_60.vcf.gz"
  VCF_20_MAF005="_TAG_Flowqual_Noindels_Norepeat_SNP_21IND_DP10_50_10_200_Na20_60_MAF005.vcf.gz"
  VCF_20_MAF005_unzip="_TAG_Flowqual_Noindels_Norepeat_SNP_21IND_DP10_50_10_200_Na20_60_MAF005.vcf"

# prefix of position file (position file contains two columns : scaffold and position)
# Adapt to your position file name
  position_20_MAF ="_TAG_Flowqual_Noindels_Norepeat_SNP_21IND_DP10_50_10_200_Na20_60_MAF005.positions"
  position_all="_TAG_Flowqual_Noindels_Norepeat_SNP_21ind.positions"
  position_20="_TAG_Flowqual_Noindels_Norepeat_SNP_21IND_DP10_50_10_200_Na20_60.positions"
  position_0="_TAG_Flowqual_Noindels_Norepeat_SNP_21IND_DP10_50_10_200_Na0_60.positions"

# Bed file generated by plink to run with Pcadapt scan
  BED_20_MAF005="_TAG_Flowqual_Noindels_Norepeat_SNP_21IND_DP10_50_10_200_Na20_60_MAF005.bed.bed"

# Table which summarise the scaffold size
  Chr		length
  SUPER_1	274107945
  SUPER_2	239769335
  SUPER_3	233268383
  SUPER_4	205643877
  
# Methods :
#----------#
# Genomic scan run on each chromosome (1 vcf by chromosomes are needed)
# For each index : 
 - Needed input VCF, position vector and table of metadata about samples and populations are read in each part
 - Result table by windows are stored in corresponding folder
 - Plot are made for each chromosome and stored in PDF in corresponding folder

# libraries needed 
#------------------#
library(bedr)
library(qvalue)
library(vcfR)
library(rlist)
library(pegas)
library(ggplot2)
library(adegenet)
library(hierfstat)
library(reshape2)
library(pcadapt)
library(ggrepel)
library(gridExtra)
library(ggbreak)
library(IRanges)
library(stringr)
library(PopGenome)
library(basetheme)
library(network)

# Stefano Mona libraries housemade
#----------------------------------#
source("R_functions/libreria_filtri_VCF_e_SFS_unfolded.r")

# function to apply filters on genotype and depth
#--------------------------------------------------#
source("R_functions/fonction_filtre_cover.R")
source("R_functions/Filter_Ref.R")
source("R_functions/Filter_Het.R")
source("R_functions/Filter_Hom_ref.R")
source("R_functions/Filter_Na.R")

# output :
#----------#
On folder with table and plot for each scan run
